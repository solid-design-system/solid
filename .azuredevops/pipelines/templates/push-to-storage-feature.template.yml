parameters:
  - name: destinationPath
    type: string
    default: ''
  - name: sourcePath
    type: string
    default: ''

steps:
  ## Deploy folder to CDN
  - task: AzureCLI@2
    displayName: 'Deploying to Azure Blob Storage'
    inputs:
      azureSubscription: 'Workload CI/CD Service Connection (S_STATICCONTENT_PROD)'
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        # Deploy to version folder
        set -x
        echo "Target folder is $(branch)"
        az storage blob upload-batch \
          --destination \$web \
          --account-name "safesoliddesignsysprod" \
          --source dist${{parameters.sourcePath}} \
          --destination-path "/$(branch)${{parameters.destinationPath}}" \
          --overwrite
        set +x

    ## Purge CDN for branch folder
  - template: purge-cdn.template.yml
    parameters:
      destinationPath: '$(branch)'
